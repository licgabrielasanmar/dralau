<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VISION BOARD 2026 by Lau</title>
    <style>
        /* ESTILOS CSS (Ajustados) */
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to bottom right, #ffecd2 0%, #fcb69f 100%);
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: center;
            overflow-x: hidden;
        }
        h1 {
            color: #8338ec;
            margin-bottom: 10px;
            font-size: 1.8em;
        }
        p {
            font-size: 1.1em;
            margin-bottom: 30px;
            color: #555;
            padding: 0 15px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .menu-button {
            background-color: #ff99c8;
            color: white;
            padding: 25px 15px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0 0 0 / 10%);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 80px;
        }
        .menu-button:active {
            transform: translateY(-2px);
        }
        /* Estilo para bot√≥n completado */
        .menu-button.completed {
            background-color: #4CAF50; /* Verde de √©xito */
            border: 3px solid #28a745;
            box-shadow: 0 0 15px #4CAF50;
        }
        
        /* ESTILO CLAVE PARA OCULTAR LOS JUEGOS INICIALMENTE */
        .game-area {
            display: none; 
            margin-top: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            background-color: #f9f9f9;
            min-height: 300px;
            position: relative;
            overflow: hidden;
        }
        .game-area.active {
            display: block;
        }
        .back-button {
            background-color: #8338ec;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 1em;
            transition: background-color 0.3s ease;
            border: none;
        }
        .back-button:active {
            background-color: #6a0dad;
        }

        /* Estilo para el mensaje final */
        #final-message-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(131, 56, 236, 0.95); /* P√∫rpura semi-transparente */
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease-in-out;
        }

        #final-message-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }
        
        #final-message-content {
            padding: 40px;
            border: 5px solid #ff99c8;
            border-radius: 20px;
            background: #fff0f5; 
            color: #8338ec;
            max-width: 80%;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            font-size: 1.5em;
            animation: pulse 2s infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }

        /* ESTILOS DEL JUEGO 1: RELACIONAR */
        #relation-game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .match-pair {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 10px;
        }
        .match-name, .match-emoji {
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0 0 0 / 10%);
        }
        .match-name {
            background-color: #ffb3c1;
            color: #555;
            width: 45%;
            text-align: left;
        }
        .match-emoji {
            background-color: #a2d2ff;
            font-size: 1.5em;
            width: 45%;
            text-align: right;
        }
        .selected {
            border: 3px solid #8338ec;
            box-shadow: 0 0 10px rgba(131, 56, 236, 0.8);
        }
        .correct {
            background-color: #d4edda;
            border: 3px solid #28a745;
            pointer-events: none;
        }
        .incorrect {
            background-color: #f8d7da;
            border: 3px solid #dc3545;
        }
        #relation-message {
            margin-top: 20px;
            font-weight: bold;
            font-size: 1.2em;
            color: #8338ec;
        }

        /* ESTILOS DEL JUEGO 2: GATO (TIC-TAC-TOE) */
        #tictactoe-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            width: 90%;
            max-width: 300px;
            aspect-ratio: 1 / 1;
            margin: 20px auto;
            border: 5px solid #cc3333;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .tictactoe-cell {
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            cursor: pointer;
            transition: background-color 0.1s;
        }
        .tictactoe-cell:not(:empty):hover {
            cursor: default;
        }
        .tictactoe-cell:hover:empty {
            background-color: #f0f0f0;
        }
        
        /* ESTILOS DEL JUEGO 3: HORMIGAS */
        #ant-game-area-canvas {
            position: relative;
            width: 100%;
            height: 300px;
            border: 1px solid #ccc;
            background-color: #e0f2f7;
            overflow: hidden;
        }
        .ant {
            position: absolute;
            font-size: 2em;
            z-index: 10;
            transition: none; 
            cursor: pointer;
        }
        .money-pile {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
            z-index: 0;
            transition: opacity 0.5s;
        }
        #ant-game-message-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            z-index: 50;
        }


        /* ESTILOS DEL JUEGO 4: SWIPE */
        #swipe-game-area {
            touch-action: pan-y; 
        }

        #swipe-game {
            position: relative;
            width: 300px;
            height: 350px;
            margin: 20px auto;
            overflow: hidden;
            border-radius: 10px;
        }
        .swipe-card {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: white;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            box-shadow: 0 2px 5px rgba(0 0 0 / 10%);
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            touch-action: none; 
        }
        .swipe-card p {
            font-size: 0.4em;
            color: #555;
            margin: 10px 0 0 0;
        }
        .swipe-game-end {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            color: #8338ec;
            padding: 20px;
            box-sizing: border-box;
            z-index: 100;
            display: none;
        }
        
        /* ESTILOS DE OTROS JUEGOS */
        #ice-cream-game {
            width: 200px;
            height: 300px;
            border-radius: 10px 10px 100px 100px;
            margin: 20px auto;
            position: relative;
            overflow: hidden;
            touch-action: none;
            background-color: #ffcccc;
        }
        #ice-cream-scoop {
            position: absolute;
            width: 180px;
            height: 180px;
            border-radius: 50%;
            transition: height 0.05s linear, width 0.05s linear, top 0.05s linear;
            background-color: #ffdab9;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
        #flower-reward {
            font-size: 1.5em; 
            margin-top: 10px;
            color: #dc3545; 
            font-weight: bold;
        }
        #mirror-game-canvas {
            border: 1px solid #ccc;
            touch-action: none;
        }
        #mirror-message {
            margin-top: 15px;
        }
        
        /* Estilo para el mensaje de 50 puntos */
        .score-message-50 {
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translate(-50%, 0);
            background: rgba(131, 56, 236, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 200;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            width: 80%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>VISION BOARD 2026 by Lau</h1>
        <p>¬°Ser√° un a√±o lleno de sorpresas, cosas bonitas y muchos logros, porque eres una persona extraordinaria!</p>

        <div class="menu-grid" id="main-menu">
            <div class="menu-button" data-game-id="relation-game-area" data-completion-key="metas">Metas Claras üéØ</div>
            <div class="menu-button" data-game-id="tictactoe-game-area" data-completion-key="habitos">H√°bitos y Rutinas üß©</div>
            <div class="menu-button" data-game-id="ant-game-area" data-completion-key="abundancia">Abundancia Financiera üí∞</div>
            <div class="menu-button" data-game-id="swipe-game-area" data-completion-key="bienestar">Bienestar F√≠sico üí™</div>
            <div class="menu-button" data-game-id="ice-cream-game-area" data-completion-key="relaciones">Relaciones Sanas ‚ù§Ô∏è</div>
            <div class="menu-button" data-game-id="travel-game-area" data-completion-key="viajes">Lugares por Conocer ‚úàÔ∏è</div>
            <div class="menu-button" data-game-id="mirror-game-area" data-completion-key="impacto">Palabras con Impacto ‚ú®</div>
        </div>

        <div id="relation-game-area" class="game-area">
            <h2>Metas Claras üéØ: Relaciona al Exitoso</h2>
            <p>Relaciona el nombre con su emoji caracter√≠stico. ¬°Demuestra que sabes identificar el √©xito!</p>
            <div id="relation-game-container">
                </div>
            <div id="relation-message" style="display:none; color: #28a745; font-size: 1.3em;">
                 Todas las personas exitosas tienen una meta. Nadie puede llegar a ninguna parte a menos que sepa ad√≥nde quiere ir y lo que quiere ser o hacer.
            </div>
            <button class="back-button" onclick="goBack()">Volver al Men√∫</button>
        </div>

        
        <div id="tictactoe-game-area" class="game-area">
            <h2>H√°bitos y Rutinas üß©: El Gato de la Disciplina</h2>
            <p>¬°Elige tu casilla (üçé)! La m√°quina (üåÆ) no se equivoca mucho. ¬°Muestra tu disciplina!</p>
            <div id="tictactoe-grid">
                </div>
            <div id="tictactoe-message" style="margin-top: 20px; font-weight: bold; font-size: 1.3em; min-height: 20px; color: #cc3333;"></div>
            <button class="back-button" id="tictactoe-back-button" onclick="goBack()" style="margin-right: 10px;">Rendirme y aceptar la derrota</button>
            <button class="back-button" onclick="initTictactoeGame()">Intentar de Nuevo</button>
        </div>

        
        <div id="ant-game-area" class="game-area">
            <h2>Abundancia Financiera üí∞</h2>
            <p>¬°Evita que las hormigas (m√°s r√°pidas) roben tu dinero! T√≥calas hasta sumar 15.</p>
            <div id="ant-game-area-canvas">
                <span class="money-pile" id="money-pile">üí∞</span>
            </div>
            <div id="ant-score">Hormigas Aplastadas: 0 / 15</div>
            <button class="back-button" onclick="goBack()">Volver al Men√∫</button>
        </div>

        
        <div id="swipe-game-area" class="game-area">
            <h2>Bienestar F√≠sico üí™</h2>
            <p>¬°Desliza a la derecha (‚úîÔ∏è) para h√°bitos positivos, a la izquierda (‚ùå) para los negativos! Suma m√°s de 50 puntos para ganar.</p>
            <div id="swipe-game">
                <div class="swipe-game-end" id="swipe-game-end-message"></div>
            </div>
            <div id="swipe-timer">Tiempo: 30s</div>
            <div id="swipe-score">Puntaje: 0</div>
            <button class="back-button" onclick="goBack()">Volver al Men√∫</button>
        </div>

        
        <div id="ice-cream-game-area" class="game-area">
            <h2>Relaciones Sanas ‚ù§Ô∏è</h2>
            <p>¬°Toca r√°pido el helado para consumirlo antes de que se derrita!</p>
            <div id="ice-cream-game">
                <div id="ice-cream-scoop"></div>
            </div>
            <div id="ice-cream-game-message">Toca: 0</div>
            <div id="flower-message">
                <span id="flower-reward" style="display:none; transition: all 0.5s;">
                    ‚ù§Ô∏è ¬°Cualquiera se derrite por ti! ‚ù§Ô∏è
                </span>
            </div>
            <button class="back-button" onclick="goBack()">Volver al Men√∫</button>
        </div>

        
        <div id="travel-game-area" class="game-area">
            <h2>Lugares por Conocer ‚úàÔ∏è</h2>
            <p>¬°Presiona los botones para inspirarte en tu pr√≥xima aventura!</p>
            <div class="travel-buttons" style="display: flex; justify-content: center; gap: 15px;">
                <div class="travel-btn" data-message="¬°Un concierto bajo las estrellas en un festival √∫nico!" style="font-size: 2em; background-color: #a2d2ff;">üé∂</div>
                <div class="travel-btn" data-message="¬°Un recorrido por las mejores cafeter√≠as de SLP!" style="font-size: 2em; background-color: #a2d2ff;">‚òï</div>
                <div class="travel-btn" data-message="¬°Una escapada a la playa para recargar energ√≠as!" style="font-size: 2em; background-color: #a2d2ff;">üèñÔ∏è</div>
                <div class="travel-btn" data-message="¬°Explorar una nueva ciudad llena de historia y arte!" style="font-size: 2em; background-color: #a2d2ff;">üèõÔ∏è</div>
                <div class="travel-btn" data-message="¬°Una aventura en la monta√±a para conectar con la naturaleza!" style="font-size: 2em; background-color: #a2d2ff;">‚õ∞Ô∏è</div>
                <div class="travel-btn" data-message="¬°Tienes tantas opciones incre√≠bles!" style="font-size: 2em; background-color: #ff99c8; pointer-events: none;" id="final-travel-btn">‚ùì</div>
            </div>
            <div id="travel-message" style="margin-top: 20px; min-height: 40px; font-size: 1.3em; font-weight: bold; color: #007bff;"></div>
            <button class="back-button" onclick="goBack()">Volver al Men√∫</button>
        </div>

        
        <div id="mirror-game-area" class="game-area">
            <h2>Palabras con Impacto ‚ú®</h2>
            <p>¬°Limpia el vapor del espejo frotando con tu dedo para REVELAR el mensaje!</p>
            <canvas id="mirror-game-canvas" width="300" height="200"></canvas>
            <div id="mirror-message" style="display:none; font-size: 1.5em; font-weight: bold; color: #8338ec;">"Eres hermosa, inteligente y m√°s que suficiente"</div>
            <button class="back-button" onclick="goBack()">Volver al Men√∫</button>
        </div>
        
    </div>
    
    <div id="final-message-overlay">
        <div id="final-message-content">
            <span style="font-size: 3em;">üåü</span>
            <p style="font-size: 1.2em; margin-top: 20px;">
                ¬°Felicidades, Lau!
            </p>
            <p style="font-size: 1.5em; font-weight: bold;">
                S√© que este a√±o ser√° incre√≠blemente bueno, <br>
                y me muero por verte lograrlo a lo grande.
            </p>
            <p style="font-size: 1.2em; color: #cc3333;">
                Tu puedes Lau.
            </p>
        </div>
    </div>

    <script>
        // --- Variables Globales ---
        let currentGameId = null;
        let animationFrames = {}; 
        
        // Rastreador de juegos completados (7 juegos)
        const completedGames = {
            metas: false,
            habitos: false,
            abundancia: false,
            bienestar: false,
            relaciones: false,
            viajes: false,
            impacto: false
        };

        // Variables para Juego 1: Relacionar
        const relationsData = [
            { name: "Taylor Swift", emoji: "üé∂", id: 1 },
            { name: "Checo P√©rez", emoji: "üèéÔ∏è", id: 2 },
            { name: "Bill Gates", emoji: "üíª", id: 3 },
            { name: "Oprah Winfrey", emoji: "üé§", id: 4 },
            { name: "Elon Musk", emoji: "üöÄ", id: 5 },
            { name: "Lau Heribia", emoji: "ü©∫", id: 6 } 
        ];
        let names = [];
        let emojis = [];
        let selectedName = null;
        let selectedEmoji = null;
        let matchesFound = 0;

        // Variables para Juego 2: Gato (Tic-Tac-Toe)
        let board = Array(9).fill(null);
        const HUMAN_PLAYER = 'üçé';
        const AI_PLAYER = 'üåÆ';
        let gameActive = false;
        const WINNING_COMBOS = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], // Filas
            [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columnas
            [0, 4, 8], [2, 4, 6]             // Diagonales
        ];

        // Variables para Juego 3: Hormigas
        const MAX_ANTS_SCORE = 15; 
        let antScore = 0;
        let antContainer = null;
        let antMoveIntervals = {};
        let antGameRunning = false;
        let antMoveSpeed = 0.5; 

        // Variables para Juego 4: Swipe
        const cardsData = [
            { emoji: 'üçî', type: 'negative', text: 'Comida Chatarra' },
            { emoji: 'üì∫', type: 'negative', text: 'Sedentarismo' },
            { emoji: 'üçé', type: 'positive', text: 'Comida Saludable' },
            { emoji: 'üèÉ‚Äç‚ôÄÔ∏è', type: 'positive', text: 'Deporte Diario' },
            { emoji: 'üò¥', type: 'positive', text: 'Dormir 8h' },
            { emoji: 'üç∑', type: 'negative', text: 'Exceso de Alcohol' },
            { emoji: ' stress', type: 'negative', text: 'Estr√©s Constante' },
            { emoji: 'ü©∫', type: 'positive', text: 'Chequeos M√©dicos' },
            { emoji: 'üßò‚Äç‚ôÄÔ∏è', type: 'positive', text: 'Meditar' },
            { emoji: 'ü•∂', type: 'negative', text: 'Falta de Agua' }
        ];
        let currentCards = [];
        let cardIndex = 0;
        let swipeScore = 0;
        let swipeTimer = 30;
        let isDragging = false;
        let startX = 0;
        let swipeGame = null;
        let activeCard = null; 

        // Variables para Juego 5: Helado
        let taps = 0;
        const maxTaps = 30;
        const initialHeight = 180;
        let iceCreamScoop = null;

        // Variables para Juego 6: Viajes
        let travelClicks = new Set();
        const totalDestinationButtons = 5;
        let travelGameCompleted = false;

        // --- Manejo de Men√∫ y Control ---
        
        // Nueva funci√≥n para marcar un juego como completado y revisar el estado general
        function markGameCompleted(key) {
            if (completedGames[key] === false) {
                completedGames[key] = true;
                
                // Marcar el bot√≥n en el men√∫ como completado
                document.querySelector(`.menu-button[data-completion-key="${key}"]`).classList.add('completed');
                
                // Verificar si todos los juegos est√°n completados
                checkAllGamesCompleted();
            }
        }

        function checkAllGamesCompleted() {
            const allCompleted = Object.values(completedGames).every(status => status === true);
            
            if (allCompleted) {
                setTimeout(showFinalMessage, 1000); 
            }
        }
        
        function showFinalMessage() {
            document.getElementById('final-message-overlay').classList.add('show');
            // Opcional: Deshabilitar el men√∫ principal si quieres forzar la atenci√≥n al mensaje
            document.getElementById('main-menu').style.pointerEvents = 'none';
        }

        function showGame(gameId) {
            document.getElementById('main-menu').style.display = 'none';
            if (currentGameId) {
                const prevGameArea = document.getElementById(currentGameId);
                if (prevGameArea) {
                    prevGameArea.classList.remove('active');
                    resetGame(currentGameId);
                }
            }
            currentGameId = gameId;
            const gameArea = document.getElementById(gameId);
            gameArea.classList.add('active');
            initializeGame(gameId);
        }

        function goBack() {
            if (currentGameId) {
                const gameArea = document.getElementById(currentGameId);
                if (gameArea) {
                    gameArea.classList.remove('active');
                    resetGame(currentGameId);
                }
            }
            document.getElementById('main-menu').style.display = 'grid';
            currentGameId = null;
        }

        function initializeGame(gameId) {
            if (animationFrames[gameId]) {
                clearInterval(animationFrames[gameId]);
                delete animationFrames[gameId];
            }
            switch (gameId) {
                case 'relation-game-area':
                    initRelationGame();
                    break;
                case 'tictactoe-game-area':
                    initTictactoeGame(); 
                    break;
                case 'ant-game-area':
                    initAntGame(); 
                    break;
                case 'swipe-game-area':
                    initSwipeGame();
                    break;
                case 'ice-cream-game-area':
                    initIceCreamGame();
                    break;
                case 'travel-game-area':
                    initTravelGame(); 
                    break;
                case 'mirror-game-area':
                    initMirrorGame();
                    break;
            }
        }

        function resetGame(gameId) {
            if (animationFrames[gameId]) {
                clearInterval(animationFrames[gameId]);
                delete animationFrames[gameId];
            }
            if (gameId === 'ant-game-area') {
                resetAntGame(); 
            }
            if (gameId === 'swipe-game-area' && swipeGame) {
                swipeGame.innerHTML = '<div class="swipe-game-end" id="swipe-game-end-message"></div>';
                const message50 = document.getElementById('swipe-message-50');
                if(message50) message50.remove();
            }
            if (gameId === 'ice-cream-game-area') {
                document.getElementById('flower-reward').style.display = 'none';
            }
            if (gameId === 'relation-game-area') {
                document.getElementById('relation-message').style.display = 'none';
                selectedName = null;
                selectedEmoji = null;
                matchesFound = 0;
                document.getElementById('relation-game-container').innerHTML = ''; 
            }
            if (gameId === 'tictactoe-game-area') {
                gameActive = false;
                document.getElementById('tictactoe-grid').innerHTML = '';
                document.getElementById('tictactoe-back-button').innerText = 'Rendirme y aceptar la derrota';
            }
            if (gameId === 'travel-game-area') {
                 travelClicks.clear(); 
            }
            if (gameId === 'mirror-game-area') {
                 document.getElementById('mirror-message').style.display = 'none';
            }
        }

        // --- Juego 1: Relacionar Famosos ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function handleMatchClick(element, type, id) {
            document.querySelectorAll('.incorrect').forEach(el => el.classList.remove('incorrect'));

            if (type === 'name') {
                if (selectedName) selectedName.classList.remove('selected');
                selectedName = element;
                selectedName.classList.add('selected');
            } else if (type === 'emoji') {
                if (selectedEmoji) selectedEmoji.classList.remove('selected');
                selectedEmoji = element;
                selectedEmoji.classList.add('selected');
            }

            if (selectedName && selectedEmoji) {
                const nameId = parseInt(selectedName.getAttribute('data-id'));
                const emojiId = parseInt(selectedEmoji.getAttribute('data-id'));

                if (nameId === emojiId) {
                    selectedName.classList.add('correct');
                    selectedEmoji.classList.add('correct');
                    selectedName.classList.remove('selected');
                    selectedEmoji.classList.remove('selected');
                    selectedName.onclick = null;
                    selectedEmoji.onclick = null;
                    
                    matchesFound++;
                    selectedName = null;
                    selectedEmoji = null;

                    if (matchesFound === relationsData.length) {
                        document.getElementById('relation-message').style.display = 'block';
                        markGameCompleted('metas'); // <--- Marcado de juego
                    }
                } else {
                    selectedName.classList.add('incorrect');
                    selectedEmoji.classList.add('incorrect');
                    
                    setTimeout(() => {
                        selectedName.classList.remove('selected', 'incorrect');
                        selectedEmoji.classList.remove('selected', 'incorrect');
                        selectedName = null;
                        selectedEmoji = null;
                    }, 500);
                }
            }
        }

        function initRelationGame() {
            names = shuffleArray(relationsData.map(r => ({ name: r.name, id: r.id })));
            emojis = shuffleArray(relationsData.map(r => ({ emoji: r.emoji, id: r.id })));
            
            const container = document.getElementById('relation-game-container');
            container.innerHTML = '';
            matchesFound = 0;

            for (let i = 0; i < names.length; i++) {
                const pairDiv = document.createElement('div');
                pairDiv.classList.add('match-pair');

                const nameDiv = document.createElement('div');
                nameDiv.classList.add('match-name');
                nameDiv.innerText = names[i].name;
                nameDiv.setAttribute('data-id', names[i].id);
                nameDiv.onclick = function() { handleMatchClick(this, 'name', names[i].id); };

                const emojiDiv = document.createElement('div');
                emojiDiv.classList.add('match-emoji');
                emojiDiv.innerText = emojis[i].emoji;
                emojiDiv.setAttribute('data-id', emojis[i].id);
                emojiDiv.onclick = function() { handleMatchClick(this, 'emoji', emojis[i].id); };

                pairDiv.appendChild(nameDiv);
                pairDiv.appendChild(emojiDiv);
                container.appendChild(pairDiv);
            }
        }


        // --- Juego 2: Gato (Tic-Tac-Toe) - AI con posibilidad de error (20%) ---
        function checkWinner(currentBoard, player) {
            return WINNING_COMBOS.some(combo => {
                return combo.every(index => {
                    return currentBoard[index] === player;
                });
            });
        }

        function getAvailableMoves(currentBoard) {
            return currentBoard
                .map((cell, index) => cell === null ? index : null)
                .filter(index => index !== null);
        }

        function minimax(newBoard, player) {
            const availSpots = getAvailableMoves(newBoard);

            if (checkWinner(newBoard, HUMAN_PLAYER)) {
                return { score: -10 };
            } else if (checkWinner(newBoard, AI_PLAYER)) {
                return { score: 10 };
            } else if (availSpots.length === 0) {
                return { score: 0 };
            }

            const moves = [];
            for (let i = 0; i < availSpots.length; i++) {
                const move = {};
                move.index = availSpots[i];
                newBoard[availSpots[i]] = player;

                if (player === AI_PLAYER) {
                    const result = minimax(newBoard, HUMAN_PLAYER);
                    move.score = result.score;
                } else {
                    const result = minimax(newBoard, AI_PLAYER);
                    move.score = result.score;
                }

                newBoard[availSpots[i]] = null; 
                moves.push(move);
            }

            let bestMoveIndex;
            if (player === AI_PLAYER) {
                let bestScore = -10000;
                for (let i = 0; i < moves.length; i++) {
                    if (moves[i].score > bestScore) {
                        bestScore = moves[i].score;
                        bestMoveIndex = i;
                    }
                }
            } else {
                let bestScore = 10000;
                for (let i = 0; i < moves.length; i++) {
                    if (moves[i].score < bestScore) {
                        bestScore = moves[i].score;
                        bestMoveIndex = i;
                    }
                }
            }
            return moves[bestMoveIndex];
        }
        
        function getAiMove() {
            // 1. Prioridad: Revisar si la IA puede ganar o si el humano puede ganar (y bloquearlo)
            const moves = getAvailableMoves(board);
            let winningMove = -1;
            let blockingMove = -1;

            for (let i = 0; i < moves.length; i++) {
                const move = moves[i];
                // Check winning
                board[move] = AI_PLAYER;
                if (checkWinner(board, AI_PLAYER)) {
                    winningMove = move;
                }
                board[move] = HUMAN_PLAYER;
                if (checkWinner(board, HUMAN_PLAYER)) {
                    blockingMove = move;
                }
                board[move] = null; // Reset
            }

            if (winningMove !== -1) return { index: winningMove };
            if (blockingMove !== -1) return { index: blockingMove };

            // 2. Posibilidad de error (20% de las veces en otros casos)
            if (Math.random() < 0.20) {
                // Mover aleatorio si no hay jugada cr√≠tica
                const randomIndex = Math.floor(Math.random() * moves.length);
                return { index: moves[randomIndex] };
            }
            
            // 3. Jugar Minimax (el mejor movimiento)
            return minimax(board, AI_PLAYER);
        }


        function aiTurn() {
            if (!gameActive) return;
            const move = getAiMove();
            if (move && move.index !== undefined) {
                makeMove(move.index, AI_PLAYER);
            }
        }

        function makeMove(index, player) {
            if (board[index] === null && gameActive) {
                board[index] = player;
                document.getElementById(`cell-${index}`).innerText = player;

                const messageEl = document.getElementById('tictactoe-message');
                const backButton = document.getElementById('tictactoe-back-button');

                if (checkWinner(board, player)) {
                    messageEl.style.color = player === HUMAN_PLAYER ? '#28a745' : '#cc3333';
                    messageEl.innerText = player === HUMAN_PLAYER ? 'üéâ ¬°GANASTE! (Incre√≠ble)' : 'ü§ñ ¬°GAN√ì EL TACO! (Sigue intentando)';
                    gameActive = false;
                    
                    if (player === HUMAN_PLAYER) {
                         backButton.innerText = '¬°Lo logr√©! Volver al Men√∫';
                         markGameCompleted('habitos'); // <--- Marcado de juego (Solo si gana)
                    }
                } else if (getAvailableMoves(board).length === 0) {
                    messageEl.style.color = '#007bff';
                    messageEl.innerText = 'ü§ù ¬°EMPATE! (La disciplina es un balance)';
                    gameActive = false;
                    markGameCompleted('habitos'); // <--- Marcado de juego (Empate tambi√©n cuenta)
                } else if (player === HUMAN_PLAYER) {
                    setTimeout(aiTurn, 300);
                }
            }
        }

        function handleCellClick(index) {
            if (gameActive && board[index] === null) {
                makeMove(index, HUMAN_PLAYER);
            }
        }

        function initTictactoeGame() {
            board = Array(9).fill(null);
            gameActive = true;
            const grid = document.getElementById('tictactoe-grid');
            const messageEl = document.getElementById('tictactoe-message');
            const backButton = document.getElementById('tictactoe-back-button');

            grid.innerHTML = '';
            messageEl.innerText = 'Tu turno (üçé)';
            messageEl.style.color = '#cc3333';
            backButton.innerText = 'Rendirme y aceptar la derrota'; 

            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.classList.add('tictactoe-cell');
                cell.id = `cell-${i}`;
                cell.onclick = () => handleCellClick(i);
                grid.appendChild(cell);
            }

            if (Math.random() > 0.5) {
                const center = 4;
                if (board[center] === null) {
                    makeMove(center, AI_PLAYER);
                    messageEl.innerText = 'El Taco üåÆ empieza. Tu turno (üçé)';
                }
            }
        }


        // --- Juego 3: Abundancia Financiera (Modificado para Recuperaci√≥n) ---
        function resetAntGame() {
            for (const key in antMoveIntervals) {
                clearInterval(antMoveIntervals[key]);
            }
            antMoveIntervals = {};
            if (animationFrames['ant-game-area']) {
                clearTimeout(animationFrames['ant-game-area']);
                delete animationFrames['ant-game-area'];
            }
            antGameRunning = false;
            antScore = 0;
            antMoveSpeed = 0.5;
            // Limpiar mensaje de game over si existe
            const messageContainer = document.getElementById('ant-game-message-container');
            if (messageContainer) messageContainer.remove();
            
            document.querySelectorAll('.ant').forEach(ant => ant.remove());
        }

        function getAntSpeed() {
             if (antScore >= 14) return 2.8; 
             if (antScore >= 12) return 2.0; 
             if (antScore >= 8) return 1.3; 
             return 0.5 + antScore * 0.1;   
        }

        function showAntGameOverMessage() {
            resetAntGame();
            
            const messageContainer = document.createElement('div');
            messageContainer.id = 'ant-game-message-container';
            messageContainer.innerHTML = `
                <span style="font-size: 1.5em; color: red;">üí∏ ¬°La hormiga rob√≥ el dinero! Juego Terminado.</span>
                <button class="back-button" onclick="initAntGame()">Recuperar Dinero (Reiniciar Juego)</button>
            `;
            antContainer.appendChild(messageContainer);
        }

        function moveAnt(ant) {
            if (!antGameRunning) {
                clearInterval(antMoveIntervals[ant.id]);
                return;
            }
            
            let currentX = parseFloat(ant.style.left) || 0;
            let currentY = parseFloat(ant.style.top) || 0;
            
            if (!antContainer) return;
            
            const speed = getAntSpeed();

            const targetX = antContainer.offsetWidth / 2 - 15; 
            const targetY = antContainer.offsetHeight / 2 - 15;
            
            const dx = targetX - currentX;
            const dy = targetY - currentY;
            
            const distance = Math.sqrt(dx * dx + dy * dy);
            const step = Math.min(distance, speed); 
            
            if (distance > 0) {
                ant.style.left = `${currentX + (dx / distance) * step}px`;
                ant.style.top = `${currentY + (dy / distance) * step}px`;
            }

            // Colisi√≥n 
            if (distance < 30) {
                showAntGameOverMessage(); 
            }
        }
        
        function startAntMovement(ant) {
            antMoveIntervals[ant.id] = setInterval(() => moveAnt(ant), 25); 
        }

        function createAnt(immediate = false) {
            if (!antGameRunning || antScore >= MAX_ANTS_SCORE) return;

            const ant = document.createElement('div');
            ant.classList.add('ant');
            ant.innerText = 'üêú';
            ant.id = `ant-${Date.now()}-${Math.random()}`;
            
            const edge = Math.floor(Math.random() * 4); 
            const containerWidth = antContainer.offsetWidth;
            const containerHeight = antContainer.offsetHeight;

            if (edge === 0) { ant.style.left = '-30px'; ant.style.top = `${Math.random() * containerHeight}px`; }
            else if (edge === 1) { ant.style.left = `${containerWidth}px`; ant.style.top = `${Math.random() * containerHeight}px`; }
            else if (edge === 2) { ant.style.top = '-30px'; ant.style.left = `${Math.random() * containerWidth}px`; }
            else { ant.style.top = `${containerHeight}px`; ant.style.left = `${Math.random() * containerWidth}px`; }

            antContainer.appendChild(ant);
            
            startAntMovement(ant);

            ant.addEventListener('pointerdown', function(e) {
                e.stopPropagation(); 
                if (ant.innerText !== 'üí•' && antGameRunning) {
                    antScore++;
                    document.getElementById('ant-score').innerText = `Hormigas Aplastadas: ${antScore} / ${MAX_ANTS_SCORE}`;
                    ant.innerText = 'üí•';
                    ant.style.pointerEvents = 'none';
                    ant.style.transition = 'opacity 0.3s';
                    ant.style.opacity = '0';
                    clearInterval(antMoveIntervals[ant.id]);
                    delete antMoveIntervals[ant.id];
                    
                    setTimeout(() => { 
                        if (ant.parentNode === antContainer) antContainer.removeChild(ant); 
                    }, 300);

                    if (antScore >= MAX_ANTS_SCORE) {
                        endAntGame(true);
                    }
                }
            });
        }
        
        function endAntGame(won) {
            resetAntGame();
            if (won) {
                 antContainer.innerHTML = '<span style="font-size: 1.5em; color: green;">üéâ ¬°Lograste la Abundancia Financiera!</span>';
                 document.getElementById('ant-score').innerText = `Hormigas Aplastadas: ${MAX_ANTS_SCORE} / ${MAX_ANTS_SCORE}`;
                 // Mostrar el dinero al ganar
                 antContainer.innerHTML += '<span class="money-pile" id="money-pile">üí∞</span>';
                 markGameCompleted('abundancia'); // <--- Marcado de juego
            }
        }


        function antLoop() {
            if (!antGameRunning || antScore >= MAX_ANTS_SCORE) return;
            
            if (antScore >= MAX_ANTS_SCORE - 6 && antScore < MAX_ANTS_SCORE) {
                // Generar 6 hormigas de golpe para los puntos finales
                for(let i=0; i<6; i++) {
                    setTimeout(() => createAnt(true), i * 50); 
                }
            } else {
                createAnt();
                const delay = Math.max(700, 2000 - antScore * 100); 
                animationFrames['ant-game-area'] = setTimeout(antLoop, delay);
            }
        }

        function initAntGame() {
            resetAntGame(); 
            antContainer = document.getElementById('ant-game-area-canvas'); 
            document.getElementById('ant-score').innerText = `Hormigas Aplastadas: 0 / ${MAX_ANTS_SCORE}`;
            antContainer.innerHTML = '<span class="money-pile" id="money-pile">üí∞</span>';
            antGameRunning = true;
            antLoop();
        }

        // --- Funciones del Juego 4: Bienestar F√≠sico (Corregido Swipe) ---

        function createCard(data, index) {
            const card = document.createElement('div');
            card.classList.add('swipe-card');
            card.style.zIndex = 100 - index;
            card.style.transform = `scale(${1 - index * 0.05}) translateY(${index * 5}px)`;
            card.dataset.type = data.type;
            card.id = index === 0 ? 'active-card' : '';
            card.innerHTML = `<span>${data.emoji}</span><p>${data.text}</p>`;

            if (index === 0) {
                activeCard = card;
                card.addEventListener('pointerdown', startSwipe);
                card.addEventListener('pointermove', moveSwipe);
                card.addEventListener('pointerup', endSwipe);
                card.addEventListener('pointercancel', endSwipe);
                // Fallbacks para asegurar compatibilidad con touch (aunque pointer events son mejores)
                card.addEventListener('touchstart', startSwipe);
                card.addEventListener('touchmove', moveSwipe);
                card.addEventListener('touchend', endSwipe);
                card.addEventListener('touchcancel', endSwipe);
            }
            return card;
        }

        function showCheerMessage() {
            const message = document.createElement('div');
            message.id = 'swipe-message-50';
            message.classList.add('score-message-50');
            message.innerHTML = "¬°T√∫ puedes, no es tan dif√≠cil! Yo te echo porras con una copa de vino üç∑ y palomitas üçø.";
            document.getElementById('swipe-game-area').appendChild(message);
            
            setTimeout(() => {
                message.style.opacity = '1';
            }, 50);

            // DURACI√ìN AUMENTADA A 6000 MS (6 segundos)
            setTimeout(() => {
                message.style.opacity = '0';
                setTimeout(() => message.remove(), 500);
            }, 6000); 
        }


        function endSwipe(e) {
            if (!isDragging || !activeCard) return;
            isDragging = false;
            
            // Si el evento no es de terminaci√≥n (up/end/cancel), salir
            if (e.type !== 'pointerup' && e.type !== 'pointercancel' && e.type !== 'touchend' && e.type !== 'touchcancel') return;
            
            // Obtener la coordenada final de forma robusta
            const finalX = (e.changedTouches && e.changedTouches.length > 0) ? e.changedTouches[0].clientX : e.clientX;
            const deltaX = finalX - startX;

            activeCard.style.transition = 'transform 0.3s ease-out, opacity 0.3s ease-out';
            
            let action = '';

            if (deltaX > 80) { action = 'positive'; } 
            else if (deltaX < -80) { action = 'negative'; }

            if (action) {
                const cardType = activeCard.dataset.type;
                
                let oldScore = swipeScore;
                if ((action === 'positive' && cardType === 'positive') || (action === 'negative' && cardType === 'negative')) {
                    swipeScore += 10;
                    activeCard.style.backgroundColor = '#d4edda';
                } else {
                    swipeScore -= 5;
                    activeCard.style.backgroundColor = '#f8d7da';
                }
                document.getElementById('swipe-score').innerText = `Puntaje: ${swipeScore}`;
                
                if (swipeScore >= 50 && oldScore < 50) {
                    showCheerMessage();
                }
                
                activeCard.style.transform = `translateX(${(action === 'positive' ? 500 : -500)}px) rotate(${action === 'positive' ? 30 : -30}deg)`;
                
                setTimeout(() => {
                    cardIndex++;
                    activeCard.remove(); 
                    activeCard = null; 
                    if (cardIndex < currentCards.length) {
                         renderSwipeCards();
                    } else {
                        endSwipeGame();
                    }
                }, 300);

            } else {
                activeCard.style.transform = 'translateX(0) rotate(0deg)';
                activeCard.style.opacity = 1;
            }
        }


        function startSwipe(e) {
            if (swipeTimer === 0 || !activeCard) return;
            isDragging = true;
            const clientX = (e.touches && e.touches.length > 0) ? e.touches[0].clientX : e.clientX;
            startX = clientX;
            activeCard.style.transition = 'none';
        }

        function moveSwipe(e) {
            if (!isDragging || !activeCard) return;
            
            const currentX = (e.touches && e.touches.length > 0) ? e.touches[0].clientX : e.clientX;
            const deltaX = currentX - startX;

            // Prevenir el scroll solo si el movimiento horizontal es significativo
            if (e.type.startsWith('touch') && Math.abs(deltaX) > 5) {
                e.preventDefault();
            }

            activeCard.style.transform = `translateX(${deltaX}px) rotate(${deltaX / 20}deg)`;
            activeCard.style.opacity = 1 - (Math.abs(deltaX) / 400);
        }

        function swipeCountdown() {
            const interval = setInterval(() => {
                swipeTimer--;
                document.getElementById('swipe-timer').innerText = `Tiempo: ${swipeTimer}s`;
                if (swipeTimer <= 0) {
                    clearInterval(interval);
                    endSwipeGame();
                }
            }, 1000);
            animationFrames['swipe-game-area'] = interval;
        }

        function endSwipeGame() {
            const messageElement = document.getElementById('swipe-game-end-message');
            messageElement.style.display = 'flex';
            
            if (activeCard) {
                 activeCard.removeEventListener('pointerdown', startSwipe);
                 activeCard.removeEventListener('pointermove', moveSwipe);
                 activeCard.removeEventListener('pointerup', endSwipe);
                 activeCard.removeEventListener('pointercancel', endSwipe);
                 activeCard.removeEventListener('touchstart', startSwipe);
                 activeCard.removeEventListener('touchmove', moveSwipe);
                 activeCard.removeEventListener('touchend', endSwipe);
                 activeCard.removeEventListener('touchcancel', endSwipe);
            }

            messageElement.innerHTML = `
                ¬°Tiempo agotado! <br>
                Tu puntaje final es: **${swipeScore}** <br><br>
                ${swipeScore >= 50 ? '¬°Meta Cumplida! Tu bienestar f√≠sico est√° en marcha.' : '¬°A seguir practicando, la disciplina no es f√°cil!'}
            `;
            
            if (swipeScore >= 50) {
                 markGameCompleted('bienestar'); // <--- Marcado de juego
            }
        }

        function renderSwipeCards() {
            Array.from(swipeGame.children).forEach(child => {
                if (child.id !== 'swipe-game-end-message') {
                    child.remove();
                }
            });

            currentCards.slice(cardIndex, cardIndex + 3).reverse().forEach((data, i) => {
                swipeGame.appendChild(createCard(data, i));
            });
            
            swipeGame.appendChild(document.getElementById('swipe-game-end-message'));
        }

        function initSwipeGame() {
            swipeGame = document.getElementById('swipe-game'); 
            currentCards = shuffleArray([...cardsData, ...cardsData, ...cardsData]); 
            cardIndex = 0;
            swipeScore = 0;
            swipeTimer = 30;
            isDragging = false;
            activeCard = null;

            document.getElementById('swipe-timer').innerText = `Tiempo: ${swipeTimer}s`;
            document.getElementById('swipe-score').innerText = `Puntaje: 0`;
            document.getElementById('swipe-game-end-message').style.display = 'none';

            renderSwipeCards();
            swipeCountdown();
        }
        
        // --- Juego 5: Relaciones Sanas ---
        function updateIceCreamScoop() {
            const remainingTaps = maxTaps - taps;
            const newHeight = Math.max(0, (remainingTaps / maxTaps) * initialHeight);
            
            iceCreamScoop.style.height = `${newHeight}px`;
            iceCreamScoop.style.width = `${newHeight}px`;
            iceCreamScoop.style.top = `${10 + (initialHeight - newHeight)}px`; 
            
            document.getElementById('ice-cream-game-message').innerText = `Toca: ${taps}/${maxTaps}`;

            if (taps >= maxTaps) {
                iceCreamScoop.style.pointerEvents = 'none';
                document.getElementById('flower-reward').style.display = 'block'; 
                markGameCompleted('relaciones'); // <--- Marcado de juego
            } else {
                document.getElementById('flower-reward').style.display = 'none';
            }
        }

        function handleIceCreamTap() {
            if (taps < maxTaps) {
                taps++;
                updateIceCreamScoop();
            }
        }

        function initIceCreamGame() {
            iceCreamScoop = document.getElementById('ice-cream-scoop'); 
            taps = 0;
            iceCreamScoop.style.pointerEvents = 'auto';
            document.getElementById('flower-reward').style.display = 'none';
            updateIceCreamScoop();

            iceCreamScoop.removeEventListener('pointerdown', handleIceCreamTap); 
            iceCreamScoop.addEventListener('pointerdown', handleIceCreamTap); 
        }
        
        // --- Juego 6: Lugares por Conocer ---
        function initTravelGame() {
            const buttons = document.querySelectorAll('#travel-game-area .travel-btn');
            const messageDisplay = document.getElementById('travel-message');
            const finalButton = document.getElementById('final-travel-btn');
            
            messageDisplay.innerText = '';
            travelClicks.clear();
            travelGameCompleted = false;

            finalButton.style.pointerEvents = 'none';
            finalButton.style.backgroundColor = '#ccc';
            finalButton.onclick = null;
            
            buttons.forEach((button, index) => {
                 if (index < totalDestinationButtons) { 
                     button.dataset.index = index;
                     button.style.pointerEvents = 'auto'; 
                     button.style.backgroundColor = '#a2d2ff';

                     button.onclick = function() {
                        messageDisplay.innerText = this.getAttribute('data-message');
                        travelClicks.add(index);
                        
                        if (travelClicks.size === totalDestinationButtons) {
                            finalButton.style.pointerEvents = 'auto';
                            finalButton.style.backgroundColor = '#ff99c8';
                            finalButton.onclick = function() {
                                messageDisplay.innerText = "¬øPor cu√°l comenzamos?";
                                buttons.forEach(btn => btn.style.pointerEvents = 'none'); 
                                markGameCompleted('viajes'); // <--- Marcado de juego
                            };
                        }
                    };
                 }
            });
        }
    
        // --- Juego 7: Palabras con Impacto ---
        function setupWipeCanvas(canvasId, resultId, wipeThreshold) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const resultElement = document.getElementById(resultId);

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillStyle = '#333';
            ctx.fillText(resultElement.innerText.replace(/"/g, ''), canvas.width / 2, canvas.height / 2); 

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            for (let i = 0; i < data.length; i += 4) {
                data[i] = 176; 
                data[i + 1] = 199; 
                data[i + 2] = 199; 
                data[i + 3] = 255; 
            }
            ctx.putImageData(imageData, 0, 0);

            let isWiping = false;
            
            function wipe(e) {
                if (!isWiping) return;
                e.preventDefault();
                
                const rect = canvas.getBoundingClientRect();
                const clientX = (e.changedTouches && e.changedTouches.length > 0) ? e.changedTouches[0].clientX : e.clientX;
                const clientY = (e.changedTouches && e.changedTouches.length > 0) ? e.changedTouches[0].clientY : e.clientY;

                const x = clientX - rect.left;
                const y = clientY - rect.top;

                ctx.globalCompositeOperation = 'destination-out';
                
                ctx.beginPath();
                ctx.arc(x, y, 25, 0, Math.PI * 2); 
                ctx.fillStyle = 'rgba(0, 0, 0, 1)'; 
                ctx.fill();
                
                ctx.globalCompositeOperation = 'source-over';

                checkCompletion();
            }
            
            function startWiping(e) {
                e.preventDefault(); 
                isWiping = true;
                wipe(e);
            }

            function stopWiping() {
                isWiping = false;
            }

            function checkCompletion() {
                const currentImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                let opaquePixels = 0;
                
                for (let i = 3; i < currentImageData.data.length; i += 4) {
                    if (currentImageData.data[i] > 10) { 
                        opaquePixels++;
                    }
                }
                const totalPixels = (canvas.width * canvas.height);
                const opacityPercent = opaquePixels / totalPixels;

                if (opacityPercent < wipeThreshold) {
                    resultElement.style.display = 'block';

                    canvas.removeEventListener('pointerdown', startWiping);
                    canvas.removeEventListener('pointermove', wipe);
                    canvas.removeEventListener('pointerup', stopWiping);
                    canvas.removeEventListener('touchstart', startWiping);
                    canvas.removeEventListener('touchmove', wipe);
                    canvas.removeEventListener('touchend', stopWiping);
                    
                    markGameCompleted('impacto'); // <--- Marcado de juego
                }
            }
            
            // Limpieza y Asignaci√≥n de Listeners
            canvas.removeEventListener('pointerdown', startWiping);
            canvas.removeEventListener('pointermove', wipe);
            canvas.removeEventListener('pointerup', stopWiping);
            canvas.removeEventListener('touchstart', startWiping);
            canvas.removeEventListener('touchmove', wipe);
            canvas.removeEventListener('touchend', stopWiping);
            
            canvas.addEventListener('pointerdown', startWiping);
            canvas.addEventListener('pointermove', wipe);
            canvas.addEventListener('pointerup', stopWiping);
            canvas.addEventListener('touchstart', startWiping);
            canvas.addEventListener('touchmove', wipe);
            canvas.addEventListener('touchend', stopWiping);
        }


        function initMirrorGame() {
            document.getElementById('mirror-message').style.display = 'none';
            const canvas = document.getElementById('mirror-game-canvas');
            if (canvas) {
                canvas.width = 300; 
                canvas.height = 200;
            }
            setupWipeCanvas('mirror-game-canvas', 'mirror-message', 0.1); 
        }

        // *** FUNCI√ìN DE INICIALIZACI√ìN FORZADA ***
        function initializeAll() {
             const menuButtons = document.querySelectorAll('.menu-button');

             menuButtons.forEach(button => {
                 const gameId = button.getAttribute('data-game-id');
                 const key = button.getAttribute('data-completion-key');
                 if (gameId) {
                     button.removeEventListener('click', () => showGame(gameId)); 
                     button.addEventListener('click', () => showGame(gameId));
                 }
                 // Aplicar estilo de completado si ya lo est√° (√∫til si se guarda el estado en localStorage)
                 if (completedGames[key]) {
                      button.classList.add('completed');
                 }
             });
             
             initTravelGame(); 
        }

        document.addEventListener('DOMContentLoaded', initializeAll);
        window.onload = initializeAll; 
    </script>
</body>
</html>